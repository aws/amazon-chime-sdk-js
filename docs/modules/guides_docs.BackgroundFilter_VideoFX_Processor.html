<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>BackgroundFilter_VideoFX_Processor | amazon-chime-sdk-js</title><meta name="description" content="Documentation for amazon-chime-sdk-js"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">amazon-chime-sdk-js</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">amazon-chime-sdk-js</a></li><li><a href="guides_docs.html">guides/docs</a></li><li><a href="guides_docs.BackgroundFilter_VideoFX_Processor.html">BackgroundFilter_VideoFX_Processor</a></li></ul><h1>Namespace BackgroundFilter_VideoFX_Processor</h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><a id="integrating-background-filters-into-a-client-application" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Integrating background filters into a client application<a id="background-filters"></a><a href="#integrating-background-filters-into-a-client-application" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><ul>
<li><a href="#integrating-background-filters-into-a-client-application">Integrating background filters into a client application</a></li>
<li><a href="#about-using-background-filters">About using background filters</a>
<ul>
<li><a href="#using-the-cross-origin-opener-policy">Using the cross-origin opener policy</a></li>
<li><a href="#simd-support">SIMD support</a></li>
<li><a href="#webgl2-support">WebGL2 support</a></li>
<li><a href="#content-delivery-and-bandwidth">Content delivery and bandwidth</a></li>
<li><a href="#browser-compatibility">Browser compatibility</a></li>
</ul>
</li>
<li><a href="#using-a-content-security-policy">Using a Content Security Policy</a>
<ul>
<li><a href="#required-csp-directives">Required CSP Directives</a>
<ul>
<li><a href="#script-policy">Script Policy</a></li>
<li><a href="#worker-policy">Worker Policy</a></li>
<li><a href="#webassembly-policy">WebAssembly Policy</a></li>
</ul>
</li>
<li><a href="#optional-csp-directives">Optional CSP Directives</a>
<ul>
<li><a href="#background-image-policy">Background Image Policy</a></li>
</ul>
</li>
<li><a href="#example-csp-declaration">Example CSP Declaration</a></li>
<li><a href="#csp-errors">CSP Errors</a></li>
</ul>
</li>
<li><a href="#adding-background-filters-to-your-application">Adding background filters to your application</a>
<ul>
<li><a href="#checking-for-support-before-offering-a-filter">Checking for support before offering a filter</a></li>
<li><a href="#creating-a-videofxconfig-object">Creating a VideoFxConfig object</a></li>
<li><a href="#creating-a-videofxprocessor-object">Creating a VideoFxProcessor object</a></li>
<li><a href="#creating-the-videotransformdevice-object">Creating the VideoTransformDevice object</a></li>
<li><a href="#tuning-resource-utilization">Tuning resource utilization</a></li>
<li><a href="#starting-video-input">Starting video input</a></li>
<li><a href="#stopping-video-input">Stopping video input</a></li>
</ul>
</li>
<li><a href="#example-background-filter">Example background filter</a></li>
</ul>
<hr>
<p>This section explains how to programmatically filter video backgrounds by using background blur 2.0 and background replacement 2.0. To add a background filter to a video stream, you need to create a <code>VideoFxProcessor</code> that contains a <code>VideoFxConfig</code> object. You then insert that processor into a <code>VideoTransformDevice</code>.</p>
<p>The background filter processor uses a TensorFlow Lite machine learning model, JavaScript Web Workers, and WebAssembly to apply a filter to the background of each frame in the video stream. These assets are downloaded at runtime when you create a <code>VideoFxProcessor</code>.</p>
<p>The new background blur and replacement filters are integrated into the <a href="https://github.com/aws/amazon-chime-sdk-js/tree/main/demos/browser">browser demo application on GitHub</a>. To try it out, launch the demo with <code>npm run start</code>, join the meeting, then click the camera to enable video. From the video filter drop down, choose one of the <strong>Background Blur 2.0</strong> or <strong>Background Replacement 2.0</strong> options.</p>
<p><strong>Topics</strong></p>
<ul>
<li><a href="#integrating-background-filters-into-a-client-application">Integrating background filters into a client application</a></li>
<li><a href="#about-using-background-filters">About using background filters</a>
<ul>
<li><a href="#using-the-cross-origin-opener-policy">Using the cross-origin opener policy</a></li>
<li><a href="#simd-support">SIMD support</a></li>
<li><a href="#webgl2-support">WebGL2 support</a></li>
<li><a href="#content-delivery-and-bandwidth">Content delivery and bandwidth</a></li>
<li><a href="#browser-compatibility">Browser compatibility</a></li>
</ul>
</li>
<li><a href="#using-a-content-security-policy">Using a Content Security Policy</a>
<ul>
<li><a href="#required-csp-directives">Required CSP Directives</a>
<ul>
<li><a href="#script-policy">Script Policy</a></li>
<li><a href="#worker-policy">Worker Policy</a></li>
<li><a href="#webassembly-policy">WebAssembly Policy</a></li>
</ul>
</li>
<li><a href="#optional-csp-directives">Optional CSP Directives</a>
<ul>
<li><a href="#background-image-policy">Background Image Policy</a></li>
</ul>
</li>
<li><a href="#example-csp-declaration">Example CSP Declaration</a></li>
<li><a href="#csp-errors">CSP Errors</a></li>
</ul>
</li>
<li><a href="#adding-background-filters-to-your-application">Adding background filters to your application</a>
<ul>
<li><a href="#checking-for-support-before-offering-a-filter">Checking for support before offering a filter</a></li>
<li><a href="#creating-a-videofxconfig-object">Creating a VideoFxConfig object</a></li>
<li><a href="#creating-a-videofxprocessor-object">Creating a VideoFxProcessor object</a></li>
<li><a href="#creating-the-videotransformdevice-object">Creating the VideoTransformDevice object</a></li>
<li><a href="#tuning-resource-utilization">Tuning resource utilization</a></li>
<li><a href="#starting-video-input">Starting video input</a></li>
<li><a href="#stopping-video-input">Stopping video input</a></li>
</ul>
</li>
<li><a href="#example-background-filter">Example background filter</a></li>
</ul>
<a id="about-using-background-filters" class="tsd-anchor"></a><h1 class="tsd-anchor-link">About using background filters<a id="about-using-background-filters"></a><a href="#about-using-background-filters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="using-the-cross-origin-opener-policy" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Using the cross-origin opener policy<a id="cross-origin-policy"></a><a href="#using-the-cross-origin-opener-policy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>To limit memory usage, the module prefers to use a <code>SharedArrayBuffer</code> for processing. However, this requires that you carefully configure web security. You must set both of these headers when serving your application HTML:</p>
<pre><code><span class="hl-0">Cross</span><span class="hl-1">-</span><span class="hl-0">Origin</span><span class="hl-1">-</span><span class="hl-0">Opener</span><span class="hl-1">-</span><span class="hl-8">Policy</span><span class="hl-1">: </span><span class="hl-0">same</span><span class="hl-1">-</span><span class="hl-0">origin</span><br/><span class="hl-0">Cross</span><span class="hl-1">-</span><span class="hl-0">Origin</span><span class="hl-1">-</span><span class="hl-0">Embedder</span><span class="hl-1">-</span><span class="hl-8">Policy</span><span class="hl-1">: </span><span class="hl-0">require</span><span class="hl-1">-</span><span class="hl-0">corp</span>
</code><button>Copy</button></pre>

<p>The server must set these because they have no meta-tag equivalents. If you don't set these headers, the background filters may use slightly more RAM.</p>
<p>Background filters can be CPU-intensive and GPU-intensive. Some mobile devices and lower-specification laptop or desktop computers may not have the power to run the filters along with multiple video streams.</p>
<a id="simd-support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">SIMD support<a id="simd-support"></a><a href="#simd-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Background filters are more efficient in environments that support Single Instruction, Multiple Data (SIMD). The filters use less CPU for a given complexity level when you enable SIMD. Low-powered devices running browsers without SIMD support may not run background filters.</p>
<a id="webgl2-support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">WebGL2 support<a id="webgl2-support"></a><a href="#webgl2-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>VideoFxProcessor</code> object requires browsers that support WebGL2 in order to access the GPU on the client device.</p>
<a id="content-delivery-and-bandwidth" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Content delivery and bandwidth<a id="delivery-caching-bandwidth"></a><a href="#content-delivery-and-bandwidth" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>An Amazon content delivery network loads the machine-learning-model files for background filters at runtime. This provides low-latency global distribution without the need to serve a full suite of files as part of your application. However, loading model files can add latency to parts of your application. To help mitigate that impact, browsers cache the model files indefinitely. That cache makes subsequent loads significantly faster. As a best practice, check for supported browsers, then create the background filter resources when users may not notice any latency. For example, you can download model files while users wait in a lobby, or while they use a device picker.</p>
<p>Your application must connect to the following:</p>
<ul>
<li>Amazon Chime SDK media services.</li>
<li>Amazon CloudFront via HTTPS (port 443).</li>
</ul>
<p>All requests are to subdomains of <code>sdkassets.chime.aws</code>. Applications that can't access the content delivery network or don't include the correct domain in their <a href="#content-security">content security policy</a> will fail their support checks and be unable to use the filters.</p>
<p>For more information about CloudFront’s IP address ranges, see <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/LocationsOfEdgeServers.html"> Locations and IP address ranges of CloudFront edge servers</a> in the <em>Amazon CloudFront Developer Guide</em>.</p>
<a id="browser-compatibility" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Browser compatibility<a id="filters-browser-compat"></a><a href="#browser-compatibility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following table lists the browsers and version that support background filters.</p>
<table>
<thead>
<tr>
<th>Browser</th>
<th>Minimum supported version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Firefox</td>
<td>76+</td>
</tr>
<tr>
<td>Chromium-based browsers and environments, including Edge and Electron</td>
<td>78+</td>
</tr>
<tr>
<td>Android Chrome</td>
<td>110+</td>
</tr>
<tr>
<td>Safari on macOS</td>
<td>16.3+</td>
</tr>
<tr>
<td>Safari on iOS (iPhone, iPad)</td>
<td>16.x</td>
</tr>
<tr>
<td>Chrome on iOS</td>
<td>110.0.0.x.x</td>
</tr>
<tr>
<td>Firefox on iOS (iPhone iPad)</td>
<td>111.0+</td>
</tr>
</tbody>
</table>
<p><code>VideoFxProcessor</code> began offering Android support in version 3.14. For Android device support on versions prior to 3.14, please use <code>BackgroundBlurVideoFrameProcessor</code> and <code>BackgroundReplacementVideoFrameProcessor</code>. You can find the guide at <a href="https://aws.github.io/amazon-chime-sdk-js/modules/backgroundfilter_video_processor.html">https://aws.github.io/amazon-chime-sdk-js/modules/backgroundfilter_video_processor.html</a>.</p>
<a id="using-a-content-security-policy" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Using a Content Security Policy<a id="content-security"></a><a href="#using-a-content-security-policy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Modern web applications use Content Security Policy to protect users from certain classes of attacks. An application that utilizes the <code>VideoFxProcessor</code> will need to include the following in policy directives to allow the Amazon Chime SDK access to resources it needs at runtime:</p>
<a id="required-csp-directives" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Required CSP Directives<a href="#required-csp-directives" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="script-policy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Script Policy<a href="#script-policy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To function, the <code>VideoFxProcessor</code> class must load JavaScript classes at runtime from an Amazon-owned CDN. These classes implement post-processing for video using WebGL2. To grant an application access to fetching and running these classes, you must include the following directives:</p>
<pre><code><span class="hl-0">script</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">       </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">blob</span><span class="hl-1">: </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.sdkassets.chime.aws</span><br/><span class="hl-0">script</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">-</span><span class="hl-0">elem</span><span class="hl-1">  </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">blob</span><span class="hl-1">: </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.sdkassets.chime.aws</span>
</code><button>Copy</button></pre>

<p>Please note that <code>script-src</code> and <code>script-src-elem</code> directives are both required for full support on Safari and Firefox browsers.</p>
<a id="worker-policy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Worker Policy<a href="#worker-policy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>VideoFxProcessor</code> loads JavaScript classes as a blob to run a web worker thread, which processes video using Machine Learning (ML) models. To grant an application access to fetching and using this worker, include:</p>
<pre><code><span class="hl-0">worker</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">       </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">blob</span><span class="hl-1">: </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.sdkassets.chime.aws</span>
</code><button>Copy</button></pre>

<a id="webassembly-policy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">WebAssembly Policy<a href="#webassembly-policy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>VideoFxProcessor</code> loads a WebAssembly (Wasm) module from the same Amazon-owned CDN. In Chrome 95 and later, compiled Wasm modules cannot be passed across multiple module boundaries. To allow fetching and instantiating these modules, please also include <code>'wasm-unsafe-eval'</code> to the <code>script-src</code> directive.</p>
<p>One can read further on the Content Security Policy’s documentation for WebAssembly <a href="https://github.com/WebAssembly/content-security-policy/blob/main/proposals/CSP.md">here</a>.  Ideally the <code>wasm-eval</code> tag would be better used, however it yet to gain official standardization. Correspondence on the directive can be found <a href="https://bugs.chromium.org/p/v8/issues/detail?id=7041">here</a>.</p>
<a id="optional-csp-directives" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Optional CSP Directives<a href="#optional-csp-directives" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="background-image-policy" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Background Image Policy<a href="#background-image-policy" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To use the background replacement filter with a dynamically loaded background image, <code>VideoFxProcessor</code> must be able to access the image. Include a <code>connect-src</code> directive with the domain that hosts the image.</p>
<a id="example-csp-declaration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Example CSP Declaration<a href="#example-csp-declaration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here is an example csp declaration to permit the use of the <code>VideoFxProcessor</code>. Please note that the definitions in the <code>connect-src</code> tag are not <code>VideoFxProcessor</code> specfic but are related to video/audio in Chime meetings.</p>
<pre><code><span class="hl-1">&lt;</span><span class="hl-0">meta</span><span class="hl-1"> </span><span class="hl-0">http</span><span class="hl-1">-</span><span class="hl-0">equiv</span><span class="hl-1">=</span><span class="hl-3">&quot;Content-Security-Policy&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">  </span><span class="hl-0">content</span><span class="hl-1">= </span><span class="hl-3">&quot;base-uri         &#39;self&#39;</span><span class="hl-11">;</span><br/><span class="hl-1">  </span><span class="hl-0">connect</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">      </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.chime.aws wss://*.chime.aws https://*.amazonaws.com wss://*.chime.aws https://*.ingest.chime.aws;</span><br/><span class="hl-1">  </span><span class="hl-0">script</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">       </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">blob</span><span class="hl-1">: </span><span class="hl-3">&#39;wasm-unsafe-eval&#39;</span><span class="hl-1"> </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.sdkassets.chime.aws;</span><br/><span class="hl-1">  </span><span class="hl-0">script</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">-</span><span class="hl-0">elem</span><span class="hl-1">  </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">blob</span><span class="hl-1">: </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.sdkassets.chime.aws;</span><br/><span class="hl-1">  </span><span class="hl-0">worker</span><span class="hl-1">-</span><span class="hl-0">src</span><span class="hl-1">       </span><span class="hl-3">&#39;self&#39;</span><span class="hl-1"> </span><span class="hl-8">blob</span><span class="hl-1">: </span><span class="hl-8">https</span><span class="hl-1">:</span><span class="hl-7">//*.sdkassets.chime.aws;</span><br/><span class="hl-3">&quot;</span><span class="hl-11">&gt;</span>
</code><button>Copy</button></pre>

<a id="csp-errors" class="tsd-anchor"></a><h2 class="tsd-anchor-link">CSP Errors<a href="#csp-errors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If any any of the required directives are omitted then the VideoFxProcessor will not be able to properly instantiate and the processor will be unsupported. Additionally, the following (or similar) errors will likely appear in the browser console:</p>
<pre><code><span class="hl-0">Refused</span><span class="hl-1"> </span><span class="hl-0">to</span><span class="hl-1"> </span><span class="hl-0">connect</span><span class="hl-1"> </span><span class="hl-0">to</span><br/><span class="hl-3">&#39;https://static.sdkassets.chime.aws/ml_media_fx/otherassets/worker.js&#39;</span><br/><span class="hl-0">because</span><span class="hl-1"> </span><span class="hl-0">it</span><span class="hl-1"> </span><span class="hl-0">violates</span><span class="hl-1"> </span><span class="hl-0">the</span><span class="hl-1"> </span><span class="hl-0">document</span><span class="hl-3">&#39;s content security policy</span><span class="hl-11">.</span>
</code><button>Copy</button></pre>

<a id="adding-background-filters-to-your-application" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Adding background filters to your application<a id="add-filters"></a><a href="#adding-background-filters-to-your-application" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The process of adding background filters follows these broad steps:</p>
<ul>
<li>Check for supported browsers.</li>
<li>Create a <code>VideoFxConfig</code> object with the configuration you’d like to use.</li>
<li>Use the configuration object to create a <code>VideoFxProcessor</code> object.</li>
<li>Include the <code>VideoFxProcessor</code> object in a <code>VideoTransformDevice</code> .</li>
<li>Use the <code>VideoTransformDevice</code> to start the video input.</li>
</ul>
<p><strong>Note</strong><br>
To complete those steps, you must first:</p>
<ul>
<li>Create a <code>Logger</code>.</li>
<li>Choose a video device of class <code>MediaDeviceInfo</code>.</li>
<li>Successfully join a <code>MeetingSession</code>.</li>
</ul>
<p>Steps in the following sections explain how to complete the process.</p>
<a id="checking-for-support-before-offering-a-filter" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Checking for support before offering a filter<a id="support-check"></a><a href="#checking-for-support-before-offering-a-filter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The Amazon Chime SDK provides an asynchronous static method that checks for supported browsers and attempts to download the required assets. However, it does not check for device performance. As a best practice, always ensure the users' browsers and devices can support the filters before you offer the filters.</p>
<pre><code><span class="hl-2">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">VideoFxProcessor</span><br/><span class="hl-1">} </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&#39;amazon-chime-sdk-js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">if</span><span class="hl-1"> (!</span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">VideoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">isSupported</span><span class="hl-1">(</span><span class="hl-0">logger</span><span class="hl-1">)) {     </span><br/><span class="hl-1">    </span><span class="hl-7">// logger is optional for isSupported</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<a id="creating-a-videofxconfig-object" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Creating a VideoFxConfig object<a id="create-videofxconfig"></a><a href="#creating-a-videofxconfig-object" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can define configurations for <code>backgroundBlur</code> and <code>backgroundReplacement</code> in the same object. However, you can't set <code>isEnabled</code> to <code>true</code> for both filters at the same time. That's an invalid configuration.</p>
<p>The <code>VideoFxConfig</code> class does no validation of its own. Validation occurs in the next step.</p>
<p>The following example shows a valid <code>VideoFxConfig</code>.</p>
<pre><code><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">videoFxConfig</span><span class="hl-1">: </span><span class="hl-12">VideoFxConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-0">backgroundBlur:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">isEnabled:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">strength:</span><span class="hl-1"> </span><span class="hl-3">&#39;medium&#39;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">backgroundReplacement:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">isEnabled:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">backgroundImageURL:</span><span class="hl-1"> </span><span class="hl-3">&#39;space.jpg&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">defaultColor:</span><span class="hl-1"> </span><span class="hl-4">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p>The following tables list the <code>VideoFxProcessor</code> properties that you can specify in the <code>VideoFxConfig</code> object.</p>
<p><strong>Background blur</strong><br>
Background blur takes the following properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isEnabled</code></td>
<td><code>boolean</code></td>
<td>When <code>true</code>, the filter blurs the background.</td>
</tr>
<tr>
<td><code>strength</code></td>
<td><code>string</code></td>
<td>Determines the extent of blurring. Valid values: <code>low</code> | <code>medium</code> | <code>high</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Background replacement</strong><br>
Background replacement takes the following parameters:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>isEnabled</code></td>
<td><code>boolean</code></td>
<td>When <code>true</code>, the filter replaces the background.</td>
</tr>
<tr>
<td><code>backgroundImageURL</code></td>
<td><code>string</code></td>
<td>The URL of the background image. The filter resizes the image dynamically to the dimensions of the current screen. You can use a string such as <code>https://...</code> or a data URL such as <code>data:image/jpeg;base64</code>.</td>
</tr>
<tr>
<td><code>defaultColor</code></td>
<td><code>string</code></td>
<td>A hex color string such as <code>000000</code> or <code>FFFFFF</code>, or a string such as <code>black</code> or <code>white</code>. If you don't specify an image URL, the processor uses the <code>defaultColor</code> as the background. If you don't specify a <code>defaultColor</code> the processor defaults to black.</td>
</tr>
</tbody>
</table>
<a id="creating-a-videofxprocessor-object" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Creating a VideoFxProcessor object<a id="create-videofxprocessor"></a><a href="#creating-a-videofxprocessor-object" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When creating the VideoFxProcessor object, AWS servers download the runtime assets, or a browser cache loads the assets. If network or CSP configurations prevent access to the assets, the <code>VideoFxProcessor.create</code> operation throws an exception. The resulting VideoFxProcessor is configured as a no-op processor, which won’t affect the video stream.</p>
<pre><code><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-0">videoFxProcessor</span><span class="hl-1">: </span><span class="hl-12">VideoFxProcessor</span><span class="hl-1"> | </span><span class="hl-12">undefined</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-2">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">videoFxProcessor</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">VideoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">(</span><span class="hl-0">logger</span><span class="hl-1">, </span><span class="hl-0">videoFxConfig</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-2">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">logger</span><span class="hl-1">.</span><span class="hl-6">warn</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p><code>VideoFxProcessor.create</code> also attempts to load the image from <code>backgroundReplacement.backgroundImageURL</code>. If the image fails to load, the processor throws an exception. The processor also throws exceptions for other reasons, such as invalid configurations, unsupported browsers, or underpowered hardware.</p>
<p><strong>Changing a configuration at runtime</strong><br>
You can change a <code>VideoFxProcessor</code> configuration at runtime by using the <code>videoFxProcessor.setEffectConfig</code> parameter. The following example shows how to enable background replacement and disable background blur.</p>
<p><strong>Note</strong><br>
You can only specify one type of background replacement at a time. Specify a value for <code>backgroundImageURL</code> or <code>defaultColor</code>, but not both.</p>
<pre><code><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundBlur</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">false</span><span class="hl-1">;</span><br/><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">true</span><span class="hl-1">;</span><br/><span class="hl-2">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">videoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">setEffectConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-2">catch</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">logger</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">())</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p>If <code>setEffectConfig</code> throws an exception, the previous configuration remains in effect. <code>setEffectConfig</code> throws exceptions under conditions similar to those that cause <code>VideoFxProcessor.create</code> to throw exceptions.</p>
<p>The following example shows how to change a background image while the video runs.</p>
<pre><code><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">backgroundImageURL</span><span class="hl-1"> = </span><span class="hl-3">&quot;https://my-domain.com/my-other-image.jpg&quot;</span><span class="hl-1">;</span><br/><span class="hl-2">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">videoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">setEffectConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-2">catch</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">logger</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">())</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<a id="creating-the-videotransformdevice-object" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Creating the VideoTransformDevice object<a id="create-video-transform"></a><a href="#creating-the-videotransformdevice-object" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following example shows how to create a <code>VideoTransformDevice</code> object that contains the <code>VideoFxProcessor</code>.</p>
<pre><code><span class="hl-7">// assuming that logger and videoInputDevice have already been set    </span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">videoTransformDevice</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DefaultVideoTransformDevice</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-0">logger</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">videoInputDevice</span><span class="hl-1">,</span><br/><span class="hl-1">  [</span><span class="hl-0">videoFxProcessor</span><span class="hl-1">]</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>

<a id="tuning-resource-utilization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Tuning resource utilization<a id="tuning"></a><a href="#tuning-resource-utilization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When creating the <code>VideoFxProcessor</code>, you can supply the optional <code>processingBudgetPerFrame</code> parameter and control the amount of CPU and GPU that the filters use.</p>
<pre><code><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-0">videoFxProcessor</span><span class="hl-1">: </span><span class="hl-12">VideoFxProcessor</span><span class="hl-1"> | </span><span class="hl-12">undefined</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">processingBudgetPerFrame</span><span class="hl-1"> = </span><span class="hl-10">50</span><span class="hl-1">;</span><br/><span class="hl-2">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">videoFxProcessor</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">VideoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">(</span><span class="hl-0">logger</span><span class="hl-1">, </span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">processingBudgetPerFrame</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-2">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">logger</span><span class="hl-1">.</span><span class="hl-6">warn</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">());</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p>The <code>VideoFxProcessor</code> requires time to process a frame. The amount of time depends on the device, the browser, and what else is running in the browser or on the device. The processor uses the concept of a <em>budget</em> to target the amount of time used to process and render each frame.</p>
<p>Processing time is in milliseconds. As an example of how to use a budget, 1 second has 1000ms. Targeting 15 frames per second of video capture results in a total budget of 1000ms/15fps = 66ms. You can set a budget of 50% of that, or 33ms, by supplying the value <code>50</code> in the <code>processingBudgetPerFrame</code> parameter, as shown in the example above.</p>
<p>The <code>VideoFxProcessor</code> then tries to process the frames within the budget specified. If processing runs over budget, the processor reduces visual quality to stay within budget. The processor continues to reduce visual quality to a minimum, at which point it stops reducing. This processing duration is measured continually, so if more resources become available, such as another app closing and freeing up CPU, the processor raises visual quality again until it hits the budget, or maximum visual quality is achieved.</p>
<p>If you don't supply a value to <code>processingBudgetPerFrame</code>, the <code>VideoFxProcessor</code> defaults to <code>50</code>.</p>
<a id="starting-video-input" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Starting video input<a id="start-video-input"></a><a href="#starting-video-input" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following example shows how to use the <code>VideoTransformDevice</code> object to start video input.</p>
<pre><code><span class="hl-7">// assuming that meetingSession has already been created</span><br/><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">meetingSession</span><span class="hl-1">.</span><span class="hl-0">audioVideo</span><span class="hl-1">.</span><span class="hl-6">startVideoInput</span><span class="hl-1">(</span><span class="hl-0">videoTransformDevice</span><span class="hl-1">);</span><br/><span class="hl-0">meetingSession</span><span class="hl-1">.</span><span class="hl-0">audioVideo</span><span class="hl-1">.</span><span class="hl-6">start</span><span class="hl-1">();</span><br/><span class="hl-0">meetingSession</span><span class="hl-1">.</span><span class="hl-0">audioVideo</span><span class="hl-1">.</span><span class="hl-6">startLocalVideoTile</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>

<a id="stopping-video-input" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Stopping video input<a id="stop-video-input"></a><a href="#stopping-video-input" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following example shows how to stop video input.</p>
<pre><code><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">meetingSession</span><span class="hl-1">.</span><span class="hl-0">audioVideo</span><span class="hl-1">.</span><span class="hl-6">stopVideoInput</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>

<a id="example-background-filter" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Example background filter<a id="example-bg-filter"></a><a href="#example-background-filter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The following example shows how to implement the filters.</p>
<pre><code><span class="hl-2">import</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">VideoFxConfig</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">VideoFxTypeConversion</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">VideoTransformDevice</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">DefaultVideoTransformDevice</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">Logger</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">VideoFxProcessor</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">MeetingSession</span><br/><span class="hl-1">} </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&#39;amazon-chime-sdk-js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-0">videoTransformDevice</span><span class="hl-1">: </span><span class="hl-12">VideoTransformDevice</span><span class="hl-1"> | </span><span class="hl-12">undefined</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-0">videoFxProcessor</span><span class="hl-1">: </span><span class="hl-12">VideoFxProcessor</span><span class="hl-1"> | </span><span class="hl-12">undefined</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">videoFxConfig</span><span class="hl-1">: </span><span class="hl-12">VideoFxConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-0">backgroundBlur:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">isEnabled:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">strength:</span><span class="hl-1"> </span><span class="hl-3">&quot;medium&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">backgroundReplacement:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">isEnabled:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">backgroundImageURL:</span><span class="hl-1"> </span><span class="hl-3">&#39;space.jpg&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">defaultColor:</span><span class="hl-1"> </span><span class="hl-4">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">addEffectsToMeeting</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">videoInputDevice</span><span class="hl-1">: </span><span class="hl-12">MediaDeviceInfo</span><span class="hl-1">, </span><span class="hl-0">meetingSession</span><span class="hl-1">: </span><span class="hl-12">MeetingSession</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">): </span><span class="hl-12">Promise</span><span class="hl-1">&lt;</span><span class="hl-12">void</span><span class="hl-1">&gt; </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">videoFxProcessor</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">VideoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">(</span><span class="hl-0">logger</span><span class="hl-1">, </span><span class="hl-0">videoFxConfig</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-2">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">logger</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">());</span><br/><span class="hl-1">        </span><span class="hl-2">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">videoTransformDevice</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DefaultVideoTransformDevice</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-0">logger</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">videoInputDevice</span><span class="hl-1">,</span><br/><span class="hl-1">        [</span><span class="hl-0">videoFxProcessor</span><span class="hl-1">]</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">meetingSession</span><span class="hl-1">.</span><span class="hl-0">audioVideo</span><span class="hl-1">.</span><span class="hl-6">startVideoInput</span><span class="hl-1">(</span><span class="hl-0">videoTransformDevice</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">enableReplacement</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundBlur</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">false</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">true</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">enableBlur</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">false</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundBlur</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">true</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">pauseEffects</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">false</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundBlur</span><span class="hl-1">.</span><span class="hl-0">isEnabled</span><span class="hl-1"> = </span><span class="hl-4">false</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">);</span><br/><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">setReplacementImage</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">newImageUrl</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">backgroundImageURL</span><span class="hl-1"> = </span><span class="hl-0">newImageUrl</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">defaultColor</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">setReplacementDefaultColor</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">newHexColor</span><span class="hl-1">: </span><span class="hl-12">string</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">defaultColor</span><span class="hl-1"> = </span><span class="hl-0">newHexColor</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundReplacement</span><span class="hl-1">.</span><span class="hl-0">backgroundImageURL</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">setBlurStrength</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">newStrength</span><span class="hl-1">: </span><span class="hl-12">number</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxConfig</span><span class="hl-1">.</span><span class="hl-0">backgroundBlur</span><span class="hl-1">.</span><span class="hl-0">strength</span><span class="hl-1"> = </span><span class="hl-0">VideoFxTypeConversion</span><span class="hl-1">.</span><span class="hl-6">useBackgroundBlurStrengthType</span><span class="hl-1">(</span><span class="hl-0">newStrength</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">updateVideoFxConfig</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-0">config</span><span class="hl-1">: </span><span class="hl-12">VideoFxConfig</span><span class="hl-1">, </span><span class="hl-0">logger</span><span class="hl-1">: </span><span class="hl-12">Logger</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">videoFxProcessor</span><span class="hl-1">.</span><span class="hl-6">setEffectConfig</span><span class="hl-1">(</span><span class="hl-0">videoFxConfig</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-2">catch</span><span class="hl-1"> (</span><span class="hl-0">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">logger</span><span class="hl-1">.</span><span class="hl-6">error</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">())</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">turnOffEffects</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">innerDevice</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">videoTransformDevice</span><span class="hl-1">?.</span><span class="hl-6">intrinsicDevice</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">videoTransformDevice</span><span class="hl-1">?.</span><span class="hl-6">stop</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">videoTransformDevice</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">videoFxProcessor</span><span class="hl-1"> = </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">meetingSession</span><span class="hl-1">.</span><span class="hl-0">audioVideo</span><span class="hl-1">.</span><span class="hl-6">startVideoInput</span><span class="hl-1">(</span><span class="hl-0">innerDevice</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p><a href="https://github.com/aws/amazon-chime-sdk-js/issues/new?assignees=&amp;labels=documentation&amp;template=documentation-request.md&amp;title=Background%20Filter_VideoFX_Processor%20feedback">Give feedback on this guide</a></p>
</div><div class="tsd-comment tsd-typography"></div></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#integrating-background-filters-into-a-client-application"><span>Integrating background filters into a client application&lt;a id=&quot;background-<wbr/>filters&quot;&gt;&lt;/a&gt;</span></a><a href="#about-using-background-filters"><span>About using background filters&lt;a id=&quot;about-<wbr/>using-<wbr/>background-<wbr/>filters&quot;&gt;&lt;/a&gt;</span></a><ul><li><a href="#using-the-cross-origin-opener-policy"><span>Using the cross-<wbr/>origin opener policy&lt;a id=&quot;cross-<wbr/>origin-<wbr/>policy&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#simd-support"><span>SIMD support&lt;a id=&quot;simd-<wbr/>support&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#webgl2-support"><span>WebGL2 support&lt;a id=&quot;webgl2-<wbr/>support&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#content-delivery-and-bandwidth"><span>Content delivery and bandwidth&lt;a id=&quot;delivery-<wbr/>caching-<wbr/>bandwidth&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#browser-compatibility"><span>Browser compatibility&lt;a id=&quot;filters-<wbr/>browser-<wbr/>compat&quot;&gt;&lt;/a&gt;</span></a></li></ul><a href="#using-a-content-security-policy"><span>Using a <wbr/>Content <wbr/>Security <wbr/>Policy&lt;a id=&quot;content-<wbr/>security&quot;&gt;&lt;/a&gt;</span></a><ul><li><a href="#required-csp-directives"><span>Required CSP <wbr/>Directives</span></a></li><li><ul><li><a href="#script-policy"><span>Script <wbr/>Policy</span></a></li><li><a href="#worker-policy"><span>Worker <wbr/>Policy</span></a></li><li><a href="#webassembly-policy"><span>Web<wbr/>Assembly <wbr/>Policy</span></a></li></ul></li><li><a href="#optional-csp-directives"><span>Optional CSP <wbr/>Directives</span></a></li><li><ul><li><a href="#background-image-policy"><span>Background <wbr/>Image <wbr/>Policy</span></a></li></ul></li><li><a href="#example-csp-declaration"><span>Example CSP <wbr/>Declaration</span></a></li><li><a href="#csp-errors"><span>CSP <wbr/>Errors</span></a></li></ul><a href="#adding-background-filters-to-your-application"><span>Adding background filters to your application&lt;a id=&quot;add-<wbr/>filters&quot;&gt;&lt;/a&gt;</span></a><ul><li><a href="#checking-for-support-before-offering-a-filter"><span>Checking for support before offering a filter&lt;a id=&quot;support-<wbr/>check&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#creating-a-videofxconfig-object"><span>Creating a <wbr/>Video<wbr/>Fx<wbr/>Config object&lt;a id=&quot;create-<wbr/>videofxconfig&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#creating-a-videofxprocessor-object"><span>Creating a <wbr/>Video<wbr/>Fx<wbr/>Processor object&lt;a id=&quot;create-<wbr/>videofxprocessor&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#creating-the-videotransformdevice-object"><span>Creating the <wbr/>Video<wbr/>Transform<wbr/>Device object&lt;a id=&quot;create-<wbr/>video-<wbr/>transform&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#tuning-resource-utilization"><span>Tuning resource utilization&lt;a id=&quot;tuning&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#starting-video-input"><span>Starting video input&lt;a id=&quot;start-<wbr/>video-<wbr/>input&quot;&gt;&lt;/a&gt;</span></a></li><li><a href="#stopping-video-input"><span>Stopping video input&lt;a id=&quot;stop-<wbr/>video-<wbr/>input&quot;&gt;&lt;/a&gt;</span></a></li></ul><a href="#example-background-filter"><span>Example background filter&lt;a id=&quot;example-<wbr/>bg-<wbr/>filter&quot;&gt;&lt;/a&gt;</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">amazon-chime-sdk-js</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
